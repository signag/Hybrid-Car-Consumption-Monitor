[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"adoring-solomon-35c001"},"spec":{"every":"1m0s","name":"HCCM_EnergyBat","offset":"1m0s","query":"//=============================================================================================================\n// This function calculates the energy stored in the car HV Battery\n// Since WEConnect only provides stateOfCharge as a percentage,\n// the actual energy needs to be calculated based on the specific battery capacity\n//\n// This is limited to a single car, for which the Vehicle Identification Number\n// and capacity must be spezified below\n//=============================================================================================================\n\n\n// !!! XXXXXXXXXXXXXXXXX ! Specify Vecicle Identification Number here !!!!!!!!!!!!!!!!!\nvin = \"XXXXXXXXXXXXXXXXX\"\n\n// !!!!!!!!!!!! XXXX ! Specify battery capacity in kWh here !!!!!!!!!!!!!!!!!!!!!!!!!!!\nHVBatCapacity = 10.0\n\nfrom(bucket: \"Car_Status\")\n    // Get the status entries of the last two hours\n    |> range(start: -2h)\n    |> filter(fn: (r) => r[\"_measurement\"] == \"carStatus\")\n    |> filter(fn: (r) => r[\"vin\"] == vin)\n    // Filter only stateOfCharge Data Points\n    |> filter(fn: (r) => r[\"_field\"] == \"stateOfCharge\")\n    // Calculate battery energy\n    |> map(\n        fn: (r) =>\n            ({\n                _measurement: \"carStatus\",\n                _time: r._time,\n                vin: r.vin,\n                _field: \"batteryEnergy\",\n                _value: HVBatCapacity * float(v: r._value) / 100.0,\n            }),\n    )\n    |> to(bucket: \"Car_Status\")"}}]